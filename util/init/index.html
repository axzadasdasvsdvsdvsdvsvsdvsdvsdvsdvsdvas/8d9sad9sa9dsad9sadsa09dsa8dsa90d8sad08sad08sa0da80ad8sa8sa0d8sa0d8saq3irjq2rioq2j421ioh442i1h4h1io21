<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Big Walk Setup</title>

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- background (wallpaper + blur + overlay) -->
  <div class="bg" aria-hidden="true">
    <div class="wallpaper"></div>
    <div class="vignette"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="grain"></div>
  </div>

  <!-- window chrome -->
  <header class="titlebar" role="banner">
    <div class="titlebar-left">
      <div class="appmark" aria-hidden="true">
        <div class="appmark-inner"></div>
      </div>
      <div class="titlewrap">
        <div class="title">Big Walk Setup</div>
        <div class="subtitle">Installer • Windows 10/11</div>
      </div>
    </div>

    <div class="titlebar-right" role="group" aria-label="Window controls">
      <button class="winbtn" type="button" aria-label="Minimize" data-win="minimize" title="Minimize">
        <span aria-hidden="true">—</span>
      </button>
      <button class="winbtn" type="button" aria-label="Maximize" data-win="maximize" title="Maximize">
        <span aria-hidden="true">▢</span>
      </button>
      <button class="winbtn danger" type="button" aria-label="Close" data-win="close" title="Close">
        <span aria-hidden="true">✕</span>
      </button>
    </div>
  </header>

  <main class="shell">
    <!-- left rail -->
    <aside class="rail" aria-label="Installer steps">
      <div class="rail-top">
        <section class="product">
          <div class="product-head">
            <div class="product-name">Big Walk</div>
            <div class="pill">BETA</div>
          </div>
          <div class="product-meta">
            <div class="meta-row">
              <span class="k">Version</span>
              <span class="v" id="versionText">0.0.0-beta</span>
            </div>
            <div class="meta-row">
              <span class="k">Publisher</span>
              <span class="v">House House Studio</span>
            </div>
          </div>
        </section>

        <nav class="steps" aria-label="Steps">
          <button class="step active" type="button" data-step="welcome" aria-current="step">
            <span class="dot"></span>
            <span class="label">Welcome</span>
            <span class="hint">Quick checks</span>
          </button>

          <button class="step" type="button" data-step="path">
            <span class="dot"></span>
            <span class="label">Location</span>
            <span class="hint">Choose folder</span>
          </button>

          <button class="step" type="button" data-step="install">
            <span class="dot"></span>
            <span class="label">Install</span>
            <span class="hint">Copying files</span>
          </button>

          <button class="step" type="button" data-step="finish">
            <span class="dot"></span>
            <span class="label">Finish</span>
            <span class="hint">Launch options</span>
          </button>
        </nav>

        <section class="rail-card">
          <div class="rail-card-title">System</div>
          <div class="rail-card-grid">
            <div class="kv">
              <span class="k">Target</span>
              <span class="v">x64</span>
            </div>
            <div class="kv">
              <span class="k">Required space</span>
              <span class="v" id="diskReq">~2.4 GB</span>
            </div>
          </div>
        </section>
      </div>

      <div class="rail-bottom">
        <div class="fineprint" id="legalFine">
          © <span id="year">2026</span> House House Studio. All rights reserved.
        </div>
      </div>
    </aside>

    <!-- main panel -->
    <section class="panel" aria-label="Installer content">
      <div class="panel-inner">
        <!-- WELCOME -->
        <section class="view show" id="view-welcome" data-view="welcome" role="region" aria-label="Welcome">
          <div class="hero">
            <div class="hero-copy">
              <div class="eyebrow">Ready to install</div>
              <h1>Install Big Walk</h1>
              <p class="lead">
                This is a beta build. Expect updates and occasional weirdness.
                Choose install folder, optional shortcuts, and launch right after install.
              </p>

              <div class="cards">
                <div class="card">
                  <div class="card-ico ok">✔</div>
                  <div class="card-body">
                    <div class="card-title">Disk space</div>
                    <div class="card-sub"><span class="mono" id="diskReq2">~2.4 GB</span> required</div>
                  </div>
                </div>

                <div class="card">
                  <div class="card-ico ok">✔</div>
                  <div class="card-body">
                    <div class="card-title">Permissions</div>
                    <div class="card-sub">Standard user supported</div>
                  </div>
                </div>

                <div class="card">
                  <div class="card-ico ok">✔</div>
                  <div class="card-body">
                    <div class="card-title">Integrity</div>
                    <div class="card-sub">Installer package verified</div>
                  </div>
                </div>
              </div>

              <div class="notice">
                <div class="notice-dot"></div>
                <div class="notice-text">
                  Tip: you can keep the default folder and just hit <b>Install</b>.
                </div>
              </div>
            </div>

            <div class="hero-art" aria-hidden="true">
              <div class="hero-art-badge">
                <div class="badge-title">Big Walk</div>
                <div class="badge-sub">Beta installer</div>
              </div>
              <div class="hero-grid"></div>
              <div class="hero-orb"></div>
            </div>
          </div>
        </section>

        <!-- PATH -->
        <section class="view" id="view-path" data-view="path" role="region" aria-label="Install Location">
          <h2>Install location</h2>
          <p class="muted">
            Choose where Big Walk will be installed. You can move it later, but it’s easier to pick the right spot now.
          </p>

          <div class="field">
            <label class="field-label" for="installPath">Install folder</label>
            <div class="field-row">
              <input class="input mono" id="installPath" type="text" spellcheck="false"
                value="C:\Program Files\Big Walk" />
              <button class="btn" type="button" id="btnBrowse">Browse</button>
            </div>
            <div class="field-help muted">
              Recommended: SSD. Avoid removable drives.
            </div>
          </div>

          <div class="split">
            <div class="panel-card">
              <div class="panel-card-title">Shortcuts</div>

              <label class="checkrow">
                <input type="checkbox" id="optDesktop" checked />
                <span class="checkui"></span>
                <span class="checktext">Create Desktop shortcut</span>
              </label>

              <label class="checkrow">
                <input type="checkbox" id="optStart" checked />
                <span class="checkui"></span>
                <span class="checktext">Add to Start Menu</span>
              </label>

              <label class="checkrow">
                <input type="checkbox" id="optAutoUpdate" />
                <span class="checkui"></span>
                <span class="checktext">Enable auto-updates (recommended)</span>
              </label>
            </div>

            <div class="panel-card">
              <div class="panel-card-title">Summary</div>
              <div class="kv">
                <span class="k">Size</span>
                <span class="v">2.4 GB</span>
              </div>
              <div class="kv">
                <span class="k">Architecture</span>
                <span class="v">x64</span>
              </div>
              <div class="kv">
                <span class="k">Install for</span>
                <span class="v">Current user</span>
              </div>
              <div class="divider"></div>
              <div class="muted small">
                You can change these later in settings.
              </div>
            </div>
          </div>
        </section>

        <!-- INSTALL -->
        <section class="view" id="view-install" data-view="install" role="region" aria-label="Install">
          <h2>Installing</h2>
          <p class="muted" id="installStatus">Preparing…</p>

          <div class="progress-card">
            <div class="progress-top">
              <div class="progress-label">Progress</div>
              <div class="progress-pct" id="progressPct">0%</div>
            </div>
            <div class="progressbar">
              <div class="progressfill" id="progressFill"></div>
            </div>
            <div class="progress-meta">
              <span class="muted small" id="progressMeta">Waiting to start</span>
              <span class="mono small" id="progressSpeed">—</span>
            </div>
          </div>

          <div class="logwrap">
            <div class="loghead">
              <div class="logtitle">Details</div>
              <div class="logactions">
                <button class="btn ghost" type="button" id="btnCopyLog">Copy</button>
                <button class="btn ghost" type="button" id="btnClearLog">Clear</button>
              </div>
            </div>
            <pre class="log mono" id="logBox"></pre>
          </div>

          <div class="muted small" style="margin-top:14px;">
            Do not close the installer during installation.
          </div>
        </section>

        <!-- FINISH -->
        <section class="view" id="view-finish" data-view="finish" role="region" aria-label="Finish">
          <div class="finish">
            <div class="finish-badge">✔</div>
            <h2>Installation complete</h2>
            <p class="muted">
              Big Walk was successfully installed.
            </p>

            <div class="panel-card" style="margin-top:12px;">
              <div class="panel-card-title">Next</div>

              <label class="checkrow">
                <input type="checkbox" id="optLaunch" checked />
                <span class="checkui"></span>
                <span class="checktext">Launch Big Walk</span>
              </label>

              <label class="checkrow">
                <input type="checkbox" id="optOpenFolder" />
                <span class="checkui"></span>
                <span class="checktext">Open install folder</span>
              </label>

              <div class="divider"></div>

              <div class="kv">
                <span class="k">Installed to</span>
                <span class="v mono" id="finalPath">C:\Program Files\Big Walk</span>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- bottom bar -->
      <footer class="bbar" aria-label="Installer actions">
        <div class="bbar-left">
          <button class="btn ghost" type="button" id="btnCancel">Cancel</button>
        </div>

        <div class="bbar-right">
          <button class="btn" type="button" id="btnBack">Back</button>
          <button class="btn primary" type="button" id="btnNext">Next</button>
        </div>
      </footer>

      <!-- toast -->
      <div class="toast" id="toast" role="status" aria-live="polite">
        <div class="toast-dot"></div>
        <div class="toast-text" id="toastText">—</div>
      </div>
    </section>
  </main>

  <script>
    // --- electron ipc (nodeIntegration=true + contextIsolation=false)
    let ipc = null;
    try {
      const { ipcRenderer } = require('electron');
      ipc = ipcRenderer;
    } catch (_) {}

    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    const state = {
      step: 'welcome',
      steps: ['welcome','path','install','finish'],
      installing: false,
      installed: false,
      progress: 0,
      timer: null,
    };

    function toast(msg) {
      const el = $('#toast');
      $('#toastText').textContent = msg;
      el.classList.add('show');
      clearTimeout(el._t);
      el._t = setTimeout(() => el.classList.remove('show'), 2200);
    }

    function setStep(step) {
      if (!state.steps.includes(step)) return;
      if (state.installing && step !== 'install') return;
      if (!state.installed && step === 'finish') return;

      state.step = step;

      $$('.view').forEach(v => v.classList.remove('show'));
      $('#view-' + step).classList.add('show');

      $$('.step').forEach(btn => {
        const isActive = btn.dataset.step === step;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-current', isActive ? 'step' : 'false');
      });

      const idx = state.steps.indexOf(step);
      $('#btnBack').disabled = (idx === 0) || state.installing;
      $('#btnCancel').disabled = state.installing;
      $('#btnNext').textContent = step === 'finish' ? 'Close' : (step === 'install' ? 'Installing…' : 'Next');
      $('#btnNext').disabled = state.installing && step === 'install';

      $('#finalPath').textContent = $('#installPath')?.value || '—';
    }

    function nextStep() {
      if (state.step === 'finish') {
        if (ipc) ipc.send('win-close');
        else window.close();
        return;
      }

      if (state.step === 'path') {
        const p = $('#installPath').value.trim();
        if (!p) return toast('Pick a valid install folder.');
      }

      if (state.step === 'install') return;

      const idx = state.steps.indexOf(state.step);
      const next = state.steps[idx + 1];
      if (!next) return;

      if (next === 'install') {
        setStep('install');
        startInstall();
        return;
      }

      setStep(next);
    }

    function backStep() {
      if (state.installing) return;
      const idx = state.steps.indexOf(state.step);
      const prev = state.steps[idx - 1];
      if (prev) setStep(prev);
    }

    function log(line) {
      const box = $('#logBox');
      box.textContent += line + '\n';
      box.scrollTop = box.scrollHeight;
    }

    function setProgress(pct, meta, speed) {
      state.progress = Math.max(0, Math.min(100, pct));
      $('#progressPct').textContent = state.progress.toFixed(0) + '%';
      $('#progressFill').style.width = state.progress + '%';
      $('#progressMeta').textContent = meta || '';
      $('#progressSpeed').textContent = speed || '—';
    }

    function startInstall() {
      if (state.installing) return;

      state.installing = true;
      state.installed = false;

      $('#btnNext').disabled = true;
      $('#btnBack').disabled = true;
      $('#btnCancel').disabled = false;
      $('#installStatus').textContent = 'Installing Big Walk…';

      $('#logBox').textContent = '';
      setProgress(0, 'Starting', '—');

      toast('Installation started');
      log('[setup] starting installer');
      log('[setup] target: ' + ($('#installPath').value || 'unknown'));
      log('[setup] preparing files…');

      let phase = 0;

      state.timer = setInterval(() => {
        const bump = 2 + Math.random() * 6;
        const next = Math.min(100, state.progress + bump);

        if (phase === 0 && next > 18) { phase = 1; log('[setup] extracting package…'); }
        else if (phase === 1 && next > 55) { phase = 2; log('[setup] copying files…'); }
        else if (phase === 2 && next > 78) { phase = 3; log('[setup] creating shortcuts…'); }
        else if (phase === 3 && next > 92) { phase = 4; log('[setup] finalizing…'); }

        const speed = (60 + Math.random()*140).toFixed(0) + ' MB/s';
        const meta =
          next < 25 ? 'Preparing files' :
          next < 60 ? 'Extracting / copying' :
          next < 90 ? 'Writing to disk' :
          'Finalizing';

        setProgress(next, meta, speed);

        if (Math.random() < 0.25) {
          const items = [
            'writing chunk to disk',
            'verifying hash',
            'registering uninstall entry',
            'checking prerequisites',
            'optimizing assets'
          ];
          log('[setup] ' + items[(Math.random() * items.length) | 0] + '…');
        }

        if (next >= 100) {
          clearInterval(state.timer);
          state.timer = null;

          state.installing = false;
          state.installed = true;

          log('[setup] done');
          $('#installStatus').textContent = 'Done.';
          toast('Installed successfully');

          $('#btnNext').disabled = false;
          $('#btnCancel').disabled = false;

          setStep('finish');
          $('#btnNext').textContent = 'Close';
        }
      }, 230);
    }

    document.addEventListener('DOMContentLoaded', () => {
      $('#year').textContent = new Date().getFullYear();

      $$('.step').forEach(btn => btn.addEventListener('click', () => setStep(btn.dataset.step)));

      $('#btnNext').addEventListener('click', nextStep);
      $('#btnBack').addEventListener('click', backStep);

      $('#btnCancel').addEventListener('click', () => {
        if (state.installing) {
          const ok = confirm('Cancel installation?');
          if (!ok) return;

          clearInterval(state.timer);
          state.timer = null;
          state.installing = false;
          setProgress(0, 'Canceled', '—');
          log('[setup] canceled by user');
          toast('Canceled');
          setStep('path');
          return;
        }

        if (ipc) ipc.send('win-close');
        else window.close();
      });

      $('#btnBrowse').addEventListener('click', async () => {
        if (ipc && ipc.invoke) {
          try {
            const picked = await ipc.invoke('pick-install-dir');
            if (picked) {
              $('#installPath').value = picked;
              toast('Folder selected');
            }
          } catch {
            toast('Browse not available');
          }
        } else {
          toast('Browse needs Electron IPC');
        }
      });

      $('#btnCopyLog').addEventListener('click', async () => {
        const txt = $('#logBox').textContent;
        try { await navigator.clipboard.writeText(txt); toast('Copied'); }
        catch { toast('Copy failed'); }
      });

      $('#btnClearLog').addEventListener('click', () => {
        $('#logBox').textContent = '';
        toast('Cleared');
      });

      // window buttons
      $$('.winbtn').forEach(btn => {
        btn.addEventListener('click', () => {
          const a = btn.dataset.win;
          if (!ipc) return;

          if (a === 'minimize') ipc.send('win-minimize');
          if (a === 'maximize') ipc.send('win-maximize');
          if (a === 'close') ipc.send('win-close');
        });
      });

      setStep('welcome');
    });
  </script>
</body>
</html>
